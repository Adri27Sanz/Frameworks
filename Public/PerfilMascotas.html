<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Patitas al Tecate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
     .navbar-nav .nav-link {
      color: white !important;
      transition: color 0.3s, background-color 0.3s;
    }

    .navbar-nav .nav-link:hover {
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 5px;
      color: #fff !important;
    }

    .navbar {
      background-color: darkolivegreen !important; 
      font-family: 'Times New Roman', sans-serif; 
    }
    
    .custom-container {
      background-color: #f1f3f2; 
      color: darkolivegreen;
      font-family: 'Times New Roman', sans-serif; 
      padding: 40px;
      border-radius: 10px;
    }

    .custom-container h2 {
      font-size: 48px; 
      margin-bottom: 30px;
    }
    .custom-container h1 {
      font-size: 24px; 
      margin-top: 60px;
    }
    .custom-container a {
      font-size: 14px; 
      display: block;
      margin-top: 10px;
    }

    .custom-container img {
      width: 40px; 
      height: auto;
      margin-bottom: 30px;
    }
    .btn-custom {
      background-color: #556b2f;
      color: white;
      border: none;
    }

    .btn-custom:hover {
      background-color: #6b8e23; 
    }

    .btn-agendar {
      background-color: #556b2f;
      color: white;
      padding: 10px 25px;
      border-radius: 25px;
      font-weight: bold;
    }

    .btn-agendar:hover {
      background-color: #6b8e23;
      color: white;
    }
  </style>
</head>
<body>

<!-- Barra de navegación -->
<nav class="navbar navbar-expand-md">
  <div class="container-fluid d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center">
      <span class="ms-2" style="color: white; font-size: 26px; font-style: italic; font-weight: bold;">
        Patitas al Rescate
      </span>
    </div>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
      <ul class="navbar-nav d-flex ms-auto">
        <li class="nav-item mx-3">
          <a class="nav-link active d-flex align-items-center" href="index.html" aria-current="page">
            <img 
              src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAjpJREFUaEPtmV9ywiAQxnd5kMkpak9Se5LqSVpPoj2JvUlzi4gPoYOTdCIBFgJrdCa88u/77cLmQxGevOGT64cFYO4MsmWgaZqNEOJgABFxv1qtjhywLACd+NNQMCLuOCCKA7jE9yAcEEUBQuK5IIoBBMTXALDmOk5FAHzi27Z9F0JsAOCDCyIbICS+qqpfE3ml1BcXRBZAjPj+6HBBTAZIEc8JMQlginguiGSAHPEcEEkAJcSXhogGKCm+JEQUAIf4UhAkAKf4EhBBgHuIz4XwAtxTvAXxab8bQi7WCRBylVJK8tjlPFyUUto13wcxEkNZYh+AsQpa6zdE7J3nt5TSeKCrF/L12WJ9AGacMYe9v/q35/YC5/P5hIjGQTqbCyAwp9Za1571ainlawoAAIzmjDKglPq1re9wExugM2mjcxt5jI5Syt1wbCgDUQCDx/jNI6TfxAEQBCZARhHNPkJUSh0AzksXmQGg1qOKBllR7IjYC1J3hgAhjxA7wOVy2Wqtr7//pDZXVaECNvpGUJvGLDjxIo+i35XcmyPJngHqK+oJkFP8rAD9BwsAqJLqFT87QAREUPxDAAQgSPEPA+CAiBL/UAADiBfbLoQqX0zVG87P/pBRZTi1fwFI9UKpEabGLxlwZCDHLlMBp/qdj57US2yM2pbaiamfLL9kFWqaZi2EMH/YOR84TMLNsmT0zSASwAwyEIh46B7s9wA5tm27r6rK/D0VbFEA1CJz9i8Ac0Y/+g7MLTK0/x9UksdA1zbkWwAAAABJRU5ErkJggg==" 
              style="height: 25px;" 
              alt="Inicio"
            />
          </a>
        </li>
        
        <li class="nav-item mx-3">
          <a class="nav-link d-flex" href="#">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAXJJREFUSEu1VdttwzAMJCF5j2SSxpvUkzSdpOkkdSapO4cVsKVsxXpQDzeIAEMflnjU8XhEePLCJ8eHKgDN8wkAToD4YneA6W8fgeiHd+y6sZRkFoCIDnC7faxBSzEmUKpHRAZOlghAxrwCAAdvXRMQfWLXneMLCcA/gm8xid5jkABgpeW7NW3hXEJXCGDMV5bzNTubBFOI+JZJZESte/fvDlChZkCtL37A4nmi3qlrA5jnczYrpY6xSop0erXwX8CqYfWkSwDgQ2QM1WjyAbi4B/GCoI4KpRNqfeRYbQDcvavOG4psc0StbWwfIK+g/bq9oNZDCFAq8uI/7nNwcr1scbaG81XEhsaviFci0SWG9So2P8lS7nfKjebpOceSIFe50bysfKsoOqXouJGkW8xu8X+AKyi1eL8xLGemNLQL4cWyXZcLLrMl9EqgovjWjoEzglLDroETmBqPTESmxI1M/s2Nd31oZO7vLflGdeg/CvQLa+LSGa3sn80AAAAASUVORK5CYII=" 
            alt="Perfil Icono" style="width: 24px; height: 24px;">
            PERFIL
          </a>
        </li>
      </ul>
    </div>

    <form class="d-flex" role="search">
      <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
      <button class="btn btn-outline-light" type="submit">Search</button>
    </form>
  </div>
</nav>  

<!-- Contenido principal -->
<div class="container main-container">
  <h2 class="text-center text-success" id="nombre-mascota">Cargando...</h2>
  <p class="text-center" id="refugio-mascota">Cargando...</p>

  <div class="text-center mb-4">
    <img id="foto-mascota" src="" class="img-fluid rounded" alt="Foto de mascota">
  </div>

  <div class="row mb-4">
    <div class="col-md-6 offset-md-3">
      <h5 class="text-success">Especificaciones</h5>
      <ul id="especificaciones-mascota">
        <!-- Los datos se llenarán con JavaScript -->
      </ul>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-10 offset-md-1">
      <h5 class="text-success">Historia</h5>
      <p id="historia-mascota">Cargando...</p>
    </div>
  </div>

  <div class="text-center mb-4">
    <button class="btn btn-agendar px-4 py-2">Agendar cita para conocerlo</button>
  </div>

  <h4 class="text-center text-success">Animales relacionados</h4>
  <div class="row mt-3" id="animales-relacionados">
    <!-- Los animales relacionados se cargarán dinámicamente -->
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // Obtiene el ID de la mascota desde localStorage
  const idMascota = localStorage.getItem('mascotaSeleccionada') || 2;
  
  // Función para cargar datos de la mascota principal
  function cargarMascotaPrincipal() {
    fetch(`http://localhost:3000/mascotas/${idMascota}`)
      .then(response => {
        if (!response.ok) throw new Error('Error al cargar mascota');
        return response.json();
      })
      .then(mascota => {
        // Actualiza el HTML con los datos de la mascota
        document.getElementById('nombre-mascota').textContent = `${mascota.cRaza} (${mascota.cEspecie})`;
        document.getElementById('refugio-mascota').textContent = `Refugio: ${mascota.nRefugioID}`;
        
        // Usa imagen diferente para perros/gatos
        const imgUrl = mascota.cEspecie.toLowerCase() === 'gato' 
          ? 'https://placekitten.com/500/300' 
          : 'https://placedog.net/500/300';
        document.getElementById('foto-mascota').src = `${imgUrl}?id=${mascota.nMascotaID}`;

        // Especificaciones
        const especificaciones = `
          <li><strong>Rescatado:</strong> ${mascota.cEstado === 'Disponible' ? 'Sí' : 'No'}</li>
          <li><strong>Color:</strong> ${mascota.cColor}</li>
          <li><strong>Edad:</strong> ${mascota.cEdad}</li>
          <li><strong>Sexo:</strong> ${mascota.cSexo}</li>
          <li><strong>Estado:</strong> ${mascota.cEstado}</li>
        `;
        document.getElementById('especificaciones-mascota').innerHTML = especificaciones;

        // Historia
        document.getElementById('historia-mascota').textContent = 
          `Esta ${mascota.cEspecie.toLowerCase()} de raza ${mascota.cRaza} está ${mascota.cEstado.toLowerCase()}. 
          ${mascota.cSexo === 'Hembra' ? 'Ella' : 'Él'} es de color ${mascota.cColor} y tiene ${mascota.cEdad}.`;

        // Cargar animales relacionados (misma especie)
        cargarAnimalesRelacionados(mascota.cEspecie, mascota.nMascotaID);
      })
      .catch(error => {
        console.error('Error:', error);
        document.getElementById('nombre-mascota').textContent = "Error al cargar los datos";
      });
  }

  // Función para cargar animales relacionados
  function cargarAnimalesRelacionados(especie, idExcluir) {
    fetch(`http://localhost:3000/mascotas?especie=${especie}`)
      .then(response => response.json())
      .then(mascotas => {
        const contenedor = document.getElementById('animales-relacionados');
        contenedor.innerHTML = '';
        
        // Filtrar y tomar máximo 4 mascotas (excluyendo la actual)
        const mascotasRelacionadas = mascotas
          .filter(m => m.nMascotaID != idExcluir)
          .slice(0, 4);
        
        mascotasRelacionadas.forEach(mascota => {
          const imgUrl = mascota.cEspecie.toLowerCase() === 'gato' 
            ? 'https://placekitten.com/300/200' 
            : 'https://placedog.net/300/200';
          
          const card = `
            <div class="col-md-3 col-6 mb-4">
              <div class="card text-center">
                <img src="${imgUrl}?id=${mascota.nMascotaID}" class="card-img-top" alt="${mascota.cRaza}">
                <div class="card-body">
                  <h6 class="card-title">${mascota.cRaza}</h6>
                  <p class="card-text">${mascota.cEspecie}<br><em>"Refugio ${mascota.nRefugioID}"</em></p>
                </div>
              </div>
            </div>
          `;
          contenedor.innerHTML += card;
        });
      })
      .catch(error => console.error('Error cargando animales relacionados:', error));
  }

  // Iniciar la carga de datos
  cargarMascotaPrincipal();
</script>
</body>
</html>